# Single declarative config for all environments

source_dir: src
skip_patterns:
  - "**/AGENTS.md"
  - "**/README.md"
  - "**/_archive/**"
  - "**/templates/**"

# Model alias registry - source files use these aliases
models:
  sonnet:
    opencode: anthropic/claude-sonnet-4-5
    claude: sonnet
    cursor: anthropic/claude-sonnet-4.5
    github-copilot: claude-sonnet-4.5
    codex: gpt-5.1-codex
    gemini: gemini-2.5-pro
  
  opus:
    opencode: anthropic/claude-opus-4-5
    claude: opus
    cursor: anthropic/claude-opus-4.5
    github-copilot: claude-opus-4.5
    codex: gpt-5.2
    gemini: gemini-2.5-pro
  
  gpt5-codex:
    opencode: openai/gpt-5.1-codex
    github-copilot: gpt-5.1-codex
    codex: gpt-5.1-codex
  
  haiku:
    opencode: anthropic/claude-haiku
    claude: haiku
    cursor: anthropic/claude-haiku
    github-copilot: claude-haiku
  
  flash:
    opencode: github-copilot/gemini-3-flash-preview
    claude: sonnet
    cursor: gemini-3-flash
    github-copilot: claude-sonnet-4.5
    gemini: gemini-3-flash
  
  kimi:
    opencode: opencode/kimi-k2.5-free

# Common hook definitions (canonical event names)
hooks:
  session_end:
    command: "python3 .claptrap/enforcement.py --event session-end"
    matcher: "*"
  
  post_tool:
    command: "python3 .claptrap/enforcement.py --event post-tool"
    matcher: "Write|Edit"

# MCP server definitions (provider-agnostic)
mcp_servers:
  serena:
    command: uvx
    args:
      - --from
      - git+https://github.com/oraios/serena
      - serena
      - start-mcp-server
      - --open-web-dashboard
      - "false"
    context:
      codex: codex
      claude: claude-code
      default: ide

  context7:
    command: npx
    args:
      - -y
      - "@upstash/context7-mcp"

  snowflake:
    command: npx
    args:
      - -y
      - "@snowflake-labs/mcp"
    params:
      - flag: --service-config-file
        prompt: Service config file path
      - flag: --account
        prompt: Account
      - flag: --user
        prompt: User
      - flag: --role
        prompt: Role
      - flag: --warehouse
        prompt: Warehouse
      - flag: --private-key-file
        prompt: Private key file path
      - flag: --private-key-file-pwd
        prompt: Private key file password
      - flag: --authenticator
        prompt: Authenticator
    env:
      PRIVATE_KEY_FILE_PWD:
        prompt: Private key file password

# Entries to add to target project's .gitignore
gitignore:
  - ".claude/"
  - ".codex/"
  - ".cursor/"
  - ".gemini/"
  - ".github/"
  - ".opencode/"
  - ".claptrap/"
  - ".serena/"

# Default feature configuration
defaults:
  agents:
    dir: agents
    suffix: .md
  commands:
    dir: commands
    suffix: .md
  skills:
    dir: skills

# Environment-specific overrides (only specify what differs)
environments:
  opencode:
    root: ~/.config/opencode
    cli: opencode
    mcp: cli  # Uses `opencode mcp list`
    mcp_install: opencode.jsonc
    hooks:
      type: plugin  # Uses JS/TS plugin, not JSON config
      file: claptrap-enforcement.ts
      events:
        session_end: session.idle
        post_tool: tool.execute.after
  
  claude:
    root: ~/.claude
    cli: claude
    mcp: cli  # Uses `claude mcp list`
    mcp_install: cli
    hooks:
      file: settings.json
      events:
        session_end: Stop
        post_tool: PostToolUse
  
  github-copilot:
    root: ~/.copilot
    cli: copilot
    mcp: mcp-config.json  # Uses config file, no CLI command
    mcp_install: mcp-config.json
    agents:
      suffix: .agent.md
      strip_model: true  # Copilot agents inherit model from calling agent
    commands:
      dir: prompts
      suffix: .prompt.md
    hooks:
      file: claptrap-hooks.json
      project_dir: .github/hooks
      events:
        session_end: sessionEnd
        post_tool: postToolUse
  
  cursor:
    root: ~/.cursor
    cli: agent
    mcp: cli  # Uses `agent mcp list`
    mcp_install: mcp.json
    hooks:
      file: hooks.json
      project_dir: .cursor
      events:
        session_end: stop
        post_tool: postToolUse
  
  codex:
    root: ~/.codex
    cli: codex
    mcp: cli  # Uses `codex mcp list`
    mcp_install: cli
    agents: false  # Not supported
    commands:
      dir: prompts
    hooks: false  # Not supported
  
  gemini:
    root: ~/.gemini
    cli: gemini
    mcp: cli  # Uses `gemini mcp list`
    mcp_install: cli
    agents: false  # Not supported
    commands: false  # Uses TOML, skip
    hooks:
      file: settings.json
      events:
        session_end: SessionEnd
        post_tool: AfterTool
